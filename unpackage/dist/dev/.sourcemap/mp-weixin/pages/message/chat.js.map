{"version":3,"sources":["uni-app:///main.js","webpack:///G:/aa-tong/my-project/recruitApp/pages/message/chat.vue?4192","webpack:///G:/aa-tong/my-project/recruitApp/pages/message/chat.vue?daa7","webpack:///G:/aa-tong/my-project/recruitApp/pages/message/chat.vue?00b8","webpack:///G:/aa-tong/my-project/recruitApp/pages/message/chat.vue?a7c7","uni-app:///pages/message/chat.vue","webpack:///G:/aa-tong/my-project/recruitApp/pages/message/chat.vue?8f87","webpack:///G:/aa-tong/my-project/recruitApp/pages/message/chat.vue?94fb"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,6F,6FAFmBA,EAAE,CAACC,iCAAH,GAAuCC,mBAAvC;AAGnBC,UAAU,CAACC,aAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA6H;AAC7H;AACwD;AACL;AACsC;;;AAGzF;AAC+K;AAC/K,gBAAgB,sLAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,2FAAM;AACR,EAAE,oGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,+FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC/BA;AAAA;AAAA;AAAA;AAA6pB,CAAgB,2pBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACyFjrB,8F;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eACA,EACA,IADA,kBACA,CACA,SACA,sBADA,EAEA,UAFA,EAGA,WAHA,EAIA,YAJA,EAKA,eALA,EAMA,WANA,EAQA,WARA,EASA,cATA,EAWA,iBAXA,EAYA,kBAZA,EAaA,OAbA,EAcA,cAdA,GAgBA,CAlBA,EAmBA,MAnBA,kBAmBA,CAnBA,EAmBA,kBACA,eACA,mBACA,gDACA,kCACA,uBACA,6CAEA,0CACA,kBACA,CAFA,EAGA,CA9BA,EA+BA,MA/BA,oBA+BA,CACA,qCACA,CAjCA,EAkCA,OAlCA,qBAkCA,CACA,kBACA,CApCA,EAqCA,WACA;AACA,aAFA,uBAEA,CACA,oBACA,0BADA,CACA;AADA,SAGA,CANA,EAOA;AACA,UARA,oBAQA,CACA,mBACA,QADA,IAGA,CAZA,EAaA;AACA,WAdA,mBAcA,GAdA,EAcA,IAdA,EAcA,CACA,mDACA,kBACA,mBACA,CAlBA,EAmBA;AACA,aApBA,uBAoBA,CACA,8CACA,mBACA,sBACA,oBACA,8BACA,mCACA,uDACA,CACA,kBACA,qBACA,cACA,KACA,SADA,EACA,wDADA,EAEA,GAFA,EAGA,CACA,wDADA,CAEA;AACA,sCACA,wDACA,sCACA,CAEA,wBARA,CAUA;AACA,wDACA,CAEA,8BACA,uCACA,2DAEA,mDAEA,8DACA,qBACA,CARA,MAQA;AACA;AACA;AACA;AACA;AACA;AACA,KA/DA;AAgEA;AACA,cAjEA,sBAiEA,GAjEA,EAiEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAzEA;AA0EA,eA1EA,yBA0EA;AACA;AACA;AACA,OAFA,EAEA,GAFA;AAGA,KA9EA;AA+EA,eA/EA,yBA+EA;AACA;AACA,KAjFA;AAkFA,cAlFA,wBAkFA;AACA;AACA;AACA,eADA,mBACA,GADA,EACA;AACA,+CADA,CACA;AACA;AACA,+DAHA,CAGA;AACA;AACA,6BADA,CACA;AACA,WAFA,EAEA,IAFA;;AAIA,+DARA,CAQA;AACA;AACA,4BADA,CACA;AACA;AACA,WAHA;AAIA,cAJA;;AAMA;AACA,SAjBA;;AAmBA,KAvGA;AAwGA,UAxGA,kBAwGA,MAxGA,EAwGA;AACA;AACA;AACA,KA3GA;AA4GA,eA5GA,uBA4GA,MA5GA,EA4GA;AACA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,KA5HA;AA6HA,cA7HA,sBA6HA,IA7HA,EA6HA;AACA;AACA;AACA;AACA;AACA;AACA,OALA,MAKA;AACA;AACA;AACA,OAHA,MAGA;AACA;AACA;AACA;AACA,KA1IA;AA2IA,cA3IA,sBA2IA,IA3IA,EA2IA;AACA;AACA;AACA;AACA,kBADA;AAEA,+BAFA,EAEA;AACA;AACA;AACA;AACA,WANA;;AAQA,OAVA,MAUA;AACA;AACA;AACA,kBADA;AAEA,gCAFA,EAEA;AACA;AACA;AACA,WALA;;AAOA;AACA,KAhKA;AAiKA;AACA,WAlKA,mBAkKA,GAlKA,EAkKA;AACA;AACA,+BAFA;AAGA,OAHA;AAIA;AACA;AACA;AACA;AACA,2CADA;AAEA,6BAFA;AAGA,sCAHA;AAIA,iCAJA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA,eAJA,MAIA;AACA;AACA;AACA,iCADA;AAEA,8BAFA;AAGA,gCAHA;;AAKA;AACA,aAnBA;AAoBA;AACA;AACA;AACA,+BADA;AAEA,4BAFA;AAGA,8BAHA;;AAKA,aA3BA;;AA6BA,SA/BA,CADA,EAJA,EAGA;;AAmCA;AACA,KAzMA;AA0MA;AACA,gBA3MA,wBA2MA,GA3MA,EA2MA;AACA;AACA,oBADA;AAEA,6BAFA;AAGA,4BAHA;;AAKA,KAjNA,EArCA,E;;;;;;;;;;;;;AC1FA;AAAA;AAAA;AAAA;AAAgxC,CAAgB,ssCAAG,EAAC,C;;;;;;;;;;;ACApyC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/message/chat.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/message/chat.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chat.vue?vue&type=template&id=042db559&scoped=true&\"\nvar renderjs\nimport script from \"./chat.vue?vue&type=script&lang=js&\"\nexport * from \"./chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chat.vue?vue&type=style&index=0&id=042db559&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"042db559\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/message/chat.vue\"\nexport default component.exports","export * from \"-!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=template&id=042db559&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.msgList\n    ? _vm.__map(_vm.msgList, function(msg, index) {\n        var $orig = _vm.__get_orig(msg)\n\n        var m0 = _vm.isSelf(msg.sender)\n        var m1 = m0 ? _vm.getUserHead(msg.sender) : null\n        var m2 = !m0 ? _vm.getUserHead(msg.sender) : null\n        return {\n          $orig: $orig,\n          m0: m0,\n          m1: m1,\n          m2: m2\n        }\n      })\n    : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<view class=\"chat-top\">\r\n\t\t\t<view class=\"chat-top-left\">\r\n\t\t\t\t<image @click=\"goBack\" class=\"left-img\" src=\"../../static/imgs/common/back.png\" mode=\"aspectFill\">\r\n\t\t\t\t</image>\r\n\t\t\t\t<view class=\"left-main\">\r\n\t\t\t\t\t<image v-if=\"headPic == null || headPic == ''\" class=\"left-main-img\"\r\n\t\t\t\t\t\tsrc=\"../../static/imgs/mine/avatar.png\" mode=\"aspectFill\">\r\n\t\t\t\t\t</image>\r\n\t\t\t\t\t<image v-else class=\"left-main-img\" :src=\"baseUrl + '/' + headPic\" mode=\"aspectFill\">\r\n\t\t\t\t\t</image>\r\n\t\t\t\t\t<view class=\"left-main-font\">\r\n\t\t\t\t\t\t<view class=\"font-name\">\r\n\t\t\t\t\t\t\t{{userName}}\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<!-- <view class=\"font-company\">\r\n\t\t\t\t\t\t\t{{companyName}}\r\n\t\t\t\t\t\t</view> -->\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"chat-top-right\">\r\n\t\t\t\t<image class=\"right-img-phone\" src=\"../../static/imgs/message/phone.png\" mode=\"aspectFill\"\r\n\t\t\t\t\t@click=\"callPhone\"></image>\r\n\t\t\t\t<navigator url=\"./moreOperations\" hover-class=\"none\" style=\"display: flex;align-items: center;\">\r\n\t\t\t\t\t<image class=\"right-img-more\" src=\"../../static/imgs/message/more.png\" mode=\"aspectFill\"></image>\r\n\t\t\t\t</navigator>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<scroll-view v-if=\"msgList\" scroll-y=\"true\" class=\"msgLst\" :style=\"{ height: scrollHeight + 'px' }\"\r\n\t\t\t:scroll-into-view=\"scrollIntoView\" scroll-with-animation=\"true\">\r\n\t\t\t<view v-if=\"loadMore && msgList.length > 0\" class=\"loadMore\" @click=\"loadMoreMsg\">\r\n\t\t\t\t查看更多消息\r\n\t\t\t</view>\r\n\t\t\t<view class=\"item\" v-for=\"(msg, index) in msgList\" :key=\"index\" :id=\"'msg_' + index\">\r\n\t\t\t\t<view style=\"margin-bottom: 20rpx; font-size: 28rpx\">\r\n\t\t\t\t\t<!-- 时间显示 -->\r\n\t\t\t\t\t<view v-if=\"msg.showTime\" class=\"time\">\r\n\t\t\t\t\t\t{{ msg.showTime }}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<!-- 消息 -->\r\n\t\t\t\t\t<view v-if=\"isSelf(msg.sender)\" style=\"display: flex\">\r\n\t\t\t\t\t\t<view style=\"flex: 1\"></view>\r\n\t\t\t\t\t\t<text v-if=\"msg.contentType == 0\" class=\"msg-right\">{{ msg.contentText }}</text>\r\n\t\t\t\t\t\t<image v-else-if=\"msg.contentType == 1\" class=\"msgPic\" :src=\"msg.contentPic\" mode=\"widthFix\"\r\n\t\t\t\t\t\t\t@click=\"previewImage(msg.contentPic)\"></image>\r\n\t\t\t\t\t\t<!-- <image v-if=\"msg.contentType == 0\" src=\"../../static/imgs/chat/r.png\" mode=\"aspectFill\" style=\"width: 30rpx; height: 30rpx; margin-left: -8rpx; margin-top: 20rpx;\"></image> -->\r\n\t\t\t\t\t\t<image class=\"head\" style=\"margin-left: 20rpx\" :src=\"getUserHead(msg.sender)\" mode=\"aspectFill\">\r\n\t\t\t\t\t\t</image>\r\n\t\t\t\t\t\t<!-- <view v-if=\"msg.readStatus == -1\">发送中</view> -->\r\n\t\t\t\t\t\t<!-- <view @click=\"chat_deleteMsgCmd(msg.receiver, msg.id)\">撤销</view> -->\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view v-else style=\"display: flex\">\r\n\t\t\t\t\t\t<image class=\"head\" :src=\"getUserHead(msg.sender)\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t\t<!-- <image v-if=\"msg.contentType == 0\" src=\"../../static/imgs/chat/l.png\" mode=\"aspectFill\" style=\"width: 30rpx; height: 30rpx; margin-right: -8rpx; margin-top: 20rpx;\"></image> -->\r\n\t\t\t\t\t\t<text v-if=\"msg.contentType == 0\" class=\"msg\">{{\r\n              msg.contentText\r\n            }}</text>\r\n\t\t\t\t\t\t<image v-else-if=\"msg.contentType == 1\" class=\"msgPic\" :src=\"msg.contentPic\" mode=\"widthFix\"\r\n\t\t\t\t\t\t\t@click=\"previewImage(msg.contentPic)\"></image>\r\n\t\t\t\t\t\t<!-- <view v-if=\"msg.readStatus == -1\">发送中</view> -->\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view style=\"height: 10rpx\"></view>\r\n\t\t</scroll-view>\r\n\t\t<view class=\"send\">\r\n\t\t\t<textarea class=\"sendText\" type=\"text\" value=\"\" v-model=\"content\" @click=\"changeMode(0)\" />\r\n\t\t\t<button v-if=\"content.length > 0\" class=\"sendBtn\" type=\"default\" @click=\"sendMsg(content, 0)\">\r\n\t\t\t\t发送\r\n\t\t\t</button>\r\n\t\t\t<image v-else class=\"sendBtn2\" src=\"../../static/imgs/chat/add.png\" mode=\"aspectFill\" @click=\"changeMode()\">\r\n\t\t\t</image>\r\n\t\t</view>\r\n\t\t<view v-if=\"mode == 1\" class=\"picMode\">\r\n\t\t\t<view class=\"\" @click=\"actionMode(0)\">\r\n\t\t\t\t<image class=\"btnPic\" src=\"../../static/imgs/chat/pic.png\" mode=\"aspectFill\"></image>\r\n\t\t\t\t<view class=\"btnTxt\">相册</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"\" @click=\"actionMode(1)\">\r\n\t\t\t\t<image class=\"btnPic\" src=\"../../static/imgs/chat/video.png\" mode=\"aspectFill\"></image>\r\n\t\t\t\t<view class=\"btnTxt\">拍摄</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport $T from \"@/common/free-lib/time.js\";\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tbaseUrl: this.$baseUrl,\r\n\t\t\t\tuserId: \"\",\r\n\t\t\t\theadPic: '',\r\n\t\t\t\tuserName: '',\r\n\t\t\t\tcompanyName: '',\r\n\t\t\t\tcontent: \"\",\r\n\r\n\t\t\t\tmsgList: [],\r\n\t\t\t\tmsgPicList: [],\r\n\r\n\t\t\t\tscrollHeight: 500,\r\n\t\t\t\tscrollIntoView: \"\",\r\n\t\t\t\tmode: 0,\r\n\t\t\t\tloadMore: true,\r\n\t\t\t};\r\n\t\t},\r\n\t\tonLoad(e) {\r\n\t\t\tconsole.log(e)\r\n\t\t\tthis.userId = e.id;\r\n\t\t\tif (e.headPic != null) this.headPic = e.headPic;\r\n\t\t\tconsole.log('4444', this.headPic)\r\n\t\t\tthis.userName = e.name;\r\n\t\t\tgetApp().globalData.chatUserId = this.userId;\r\n\r\n\t\t\tuni.$on(\"userMsgUpdate\", (data) => {\r\n\t\t\t\tthis.flushData();\r\n\t\t\t});\r\n\t\t},\r\n\t\tonShow() {\r\n\t\t\tthis.chat_updateUserMsg(this.userId);\r\n\t\t},\r\n\t\tonReady() {\r\n\t\t\tthis.calcHeight();\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 电话联系\r\n\t\t\tcallPhone() {\r\n\t\t\t\tuni.makePhoneCall({\r\n\t\t\t\t\tphoneNumber: this.userName //仅为示例\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 返回上一层\r\n\t\t\tgoBack() {\r\n\t\t\t\tuni.navigateBack({\r\n\t\t\t\t\tdelta: 1\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 发送消息\r\n\t\t\tsendMsg(txt, type) {\r\n\t\t\t\tthis.chat_sendMsgToUserCmd(this.userId, txt, type);\r\n\t\t\t\tthis.content = \"\";\r\n\t\t\t\tthis.changeMode(0);\r\n\t\t\t},\r\n\t\t\t// 获取聊天记录\r\n\t\t\tflushData() {\r\n\t\t\t\tlet userIdx = this.chat_findUser(this.userId);\r\n\t\t\t\tif (userIdx > -1) {\r\n\t\t\t\t\tlet oldStartMsgId = 0;\r\n\t\t\t\t\tlet oldEndMsgId = 0;\r\n\t\t\t\t\tif (this.msgList.length > 0) {\r\n\t\t\t\t\t\toldStartMsgId = this.msgList[0].id;\r\n\t\t\t\t\t\toldEndMsgId = this.msgList[this.msgList.length - 1].id;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.msgList = [];\r\n\t\t\t\t\tthis.msgPicList = [];\r\n\t\t\t\t\tlet temp = {};\r\n\t\t\t\t\tfor (\r\n\t\t\t\t\t\tlet i = 0; i < getApp().globalData.userList[userIdx].msgList.length;\r\n\t\t\t\t\t\t++i\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\ttemp = getApp().globalData.userList[userIdx].msgList[i];\r\n\t\t\t\t\t\t//处理图片\r\n\t\t\t\t\t\tif (temp.contentType == 1) {\r\n\t\t\t\t\t\t\ttemp.contentPic = this.baseUrl + \"/\" + temp.contentText;\r\n\t\t\t\t\t\t\tthis.msgPicList.push(temp.contentPic);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis.msgList.push(temp);\r\n\r\n\t\t\t\t\t\t//处理时间\r\n\t\t\t\t\t\tthis.msgList[i].showTime = this.getMsgTime(i);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (this.msgList.length > 0) {\r\n\t\t\t\t\t\tlet newStartMsgId = this.msgList[0].id;\r\n\t\t\t\t\t\tlet newEndMsgId = this.msgList[this.msgList.length - 1].id;\r\n\r\n\t\t\t\t\t\tif (oldEndMsgId != newEndMsgId) this.scrollToMsg();\r\n\r\n\t\t\t\t\t\tif (this.msgList[0].isLastHistory) this.loadMore = false;\r\n\t\t\t\t\t\telse this.loadMore = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.loadMore = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log('聊天信息');\r\n\t\t\t\tconsole.log(this.msgList)\r\n\t\t\t},\r\n\t\t\t// 消息时间\r\n\t\t\tgetMsgTime(idx) {\r\n\t\t\t\tlet time1 = 0;\r\n\t\t\t\tlet time2 = $T.ISO8601DateStr2Date(this.msgList[idx].time);\r\n\t\t\t\tif (idx > 0) {\r\n\t\t\t\t\ttime1 = $T.ISO8601DateStr2Date(this.msgList[idx - 1].time);\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = $T.getChatTime(time2, time1);\r\n\t\t\t\treturn ret;\r\n\t\t\t},\r\n\t\t\tscrollToMsg() {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.scrollIntoView = \"msg_\" + (this.msgList.length - 1);\r\n\t\t\t\t}, 200);\r\n\t\t\t},\r\n\t\t\tloadMoreMsg() {\r\n\t\t\t\tthis.chat_getMsgHistoryCmd(this.userId, true);\r\n\t\t\t},\r\n\t\t\tcalcHeight() {\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tuni.getSystemInfo({\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\tlet windownHeight = res.windowHeight; //windoHeight为窗口高度，主要使用的是这个\r\n\t\t\t\t\t\tlet svTop = 0;\r\n\t\t\t\t\t\tlet sv = uni.createSelectorQuery().select(\".msgLst\"); //想要获取高度的元素名（class/id）\r\n\t\t\t\t\t\tsv.boundingClientRect((data) => {\r\n\t\t\t\t\t\t\tsvTop = data.top; //计算高度：元素高度=窗口高度-元素距离顶部的距离（data.top）\r\n\t\t\t\t\t\t}).exec();\r\n\r\n\t\t\t\t\t\tlet send = uni.createSelectorQuery().select(\".send\"); //想要获取高度的元素名（class/id）\r\n\t\t\t\t\t\tsend\r\n\t\t\t\t\t\t\t.boundingClientRect((data) => {\r\n\t\t\t\t\t\t\t\tthat.scrollHeight = windownHeight - svTop - data.height;\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.exec();\r\n\r\n\t\t\t\t\t\tconsole.log(that.scrollHeight);\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tisSelf(sender) {\r\n\t\t\t\tif (getApp().globalData.chatInfo.userId == sender) return true;\r\n\t\t\t\telse return false;\r\n\t\t\t},\r\n\t\t\tgetUserHead(userId) {\r\n\t\t\t\tlet headPic = \"\";\r\n\t\t\t\tif (getApp().globalData.userInfo.userId == userId) {\r\n\t\t\t\t\theadPic = getApp().globalData.userInfo.userHeadPic;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet userList = getApp().globalData.userList;\r\n\t\t\t\t\tfor (let i = 0; i < userList.length; ++i) {\r\n\t\t\t\t\t\tif (userList[i].userId == userId) {\r\n\t\t\t\t\t\t\theadPic = userList[i].head_pic;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (headPic) return this.baseUrl + \"/\" + headPic;\r\n\t\t\t\telse return \"../../static/imgs/mine/avatar.png\";\r\n\t\t\t},\r\n\t\t\tchangeMode(mode) {\r\n\t\t\t\tif (mode == 0) {\r\n\t\t\t\t\tif (this.mode == 1) {\r\n\t\t\t\t\t\tthis.mode = 0;\r\n\t\t\t\t\t\tthis.scrollHeight += uni.upx2px(300);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (this.mode == 0) {\r\n\t\t\t\t\tthis.mode = 1;\r\n\t\t\t\t\tthis.scrollHeight -= uni.upx2px(300);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.mode = 0;\r\n\t\t\t\t\tthis.scrollHeight += uni.upx2px(300);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tactionMode(type) {\r\n\t\t\t\tif (type == 0) {\r\n\t\t\t\t\t//图片\r\n\t\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\t\tcount: 9,\r\n\t\t\t\t\t\tsourceType: [\"album\"], //从相册选择\r\n\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\tconsole.log(\"图片选择成功\", res);\r\n\t\t\t\t\t\t\tthis.sendpic(res);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (type == 1) {\r\n\t\t\t\t\t//拍摄\r\n\t\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\t\tcount: 9,\r\n\t\t\t\t\t\tsourceType: [\"camera\"], //从选择\r\n\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\tthis.sendpic(res);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 发送图片\r\n\t\t\tsendpic(res) {\r\n\t\t\t\tconst tempFilePaths = res.tempFilePaths;\r\n\t\t\t\tlet promiseWorkList = [];\r\n\t\t\t\tfor (let i = 0; i < tempFilePaths.length; i++) {\r\n\t\t\t\t\tpromiseWorkList.push(\r\n\t\t\t\t\t\tnew Promise((resolve, reject) => {\r\n\t\t\t\t\t\t\tconsole.log(\"上传项\", tempFilePaths[i]);\r\n\t\t\t\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\t\t\t\turl: this.baseUrl + \"/upload\",\r\n\t\t\t\t\t\t\t\tfileType: \"image\",\r\n\t\t\t\t\t\t\t\tfilePath: tempFilePaths[i],\r\n\t\t\t\t\t\t\t\tname: \"upload-images\",\r\n\t\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"上传成功\", res);\r\n\t\t\t\t\t\t\t\t\tif (res.statusCode === 200) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log(\"图片信息\", res.data);\r\n\t\t\t\t\t\t\t\t\t\tlet pic = res.data.split(\"|\")[0];\r\n\t\t\t\t\t\t\t\t\t\tthis.sendMsg(pic, 1);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log()(\"failt to upload image:\", res);\r\n\t\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: \"图片上传失败\",\r\n\t\t\t\t\t\t\t\t\t\t\ticon: \"none\",\r\n\t\t\t\t\t\t\t\t\t\t\tduration: 2000,\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail: (res) => {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"failt to upload image:\", res);\r\n\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\ttitle: \"网络连接失败\",\r\n\t\t\t\t\t\t\t\t\t\ticon: \"none\",\r\n\t\t\t\t\t\t\t\t\t\tduration: 2000,\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 预览图片\r\n\t\t\tpreviewImage(url) {\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\tcurrent: url,\r\n\t\t\t\t\turls: this.msgPicList,\r\n\t\t\t\t\tindicator: \"default\",\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t},\r\n\t};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.chat-top {\r\n\t\tpadding: 57rpx 30rpx 17rpx;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tbackground-color: #fff;\r\n\t\tborder-bottom: 4rpx solid #F3F7FA;\r\n\r\n\t\t.chat-top-left {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\r\n\t\t\t.left-img {\r\n\t\t\t\twidth: 17rpx;\r\n\t\t\t\theight: 30rpx;\r\n\t\t\t\tmargin-right: 30rpx;\r\n\t\t\t}\r\n\r\n\t\t\t.left-main {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\r\n\t\t\t\t.left-main-img {\r\n\t\t\t\t\twidth: 66rpx;\r\n\t\t\t\t\theight: 66rpx;\r\n\t\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t\t\tborder-radius: 50%;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.left-main-font {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tflex-direction: column;\r\n\t\t\t\t\tjustify-content: space-between;\r\n\r\n\t\t\t\t\t.font-name {\r\n\t\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t\t\tcolor: #061D4C;\r\n\t\t\t\t\t\tfont-weight: bold;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.chat-top-right {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\r\n\t\t\t.right-img-phone {\r\n\t\t\t\twidth: 27rpx;\r\n\t\t\t\theight: 27rpx;\r\n\t\t\t\tmargin-right: 50rpx;\r\n\t\t\t}\r\n\r\n\t\t\t.right-img-more {\r\n\t\t\t\twidth: 30rpx;\r\n\t\t\t\theight: 6rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.msgLst {\r\n\t\tbackground-color: #fff;\r\n\r\n\t\t.loadMore {\r\n\t\t\ttext-align: center;\r\n\t\t\tfont-size: 28rpx;\r\n\t\t\tcolor: #444444;\r\n\t\t\tmargin: 20rpx;\r\n\t\t}\r\n\r\n\t\t.item {\r\n\t\t\tmargin: 20rpx;\r\n\t\t\tfont-size: 28rpx;\r\n\r\n\t\t\t.head {\r\n\t\t\t\twidth: 80rpx;\r\n\t\t\t\theight: 80rpx;\r\n\t\t\t\tborder-radius: 80rpx;\r\n\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t}\r\n\r\n\t\t\t.time {\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tfont-size: 22rpx;\r\n\t\t\t\tcolor: #888888;\r\n\t\t\t\tpadding: 20rpx;\r\n\t\t\t}\r\n\r\n\t\t\t.msg {\r\n\t\t\t\tmax-width: 450rpx;\r\n\t\t\t\tpadding: 18rpx 19rpx 18rpx 21rpx;\r\n\t\t\t\tword-wrap: break-word;\r\n\t\t\t\tbackground-color: #F5F6FA;\r\n\t\t\t\tborder-radius: 0 10rpx 10rpx;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: #061D4C;\r\n\t\t\t}\r\n\r\n\t\t\t.msg-right {\r\n\t\t\t\tmax-width: 450rpx;\r\n\t\t\t\tpadding: 18rpx 20rpx 18rpx 27rpx;\r\n\t\t\t\tword-wrap: break-word;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tbackground-color: #5EB7F5;\r\n\t\t\t\tcolor: #fff;\r\n\t\t\t\tborder-radius: 10rpx 0 10rpx 10rpx;\r\n\t\t\t}\r\n\r\n\t\t\t.msgPic {\r\n\t\t\t\tmax-width: 250rpx;\r\n\t\t\t\tbackground-color: #ffffff;\r\n\t\t\t\tborder-radius: 10rpx;\r\n\t\t\t\tborder: 1rpx solid #cccccc;\r\n\t\t\t}\r\n\r\n\t\t\t.tip {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tmargin-top: 60rpx;\r\n\t\t\t\tmargin-bottom: 40rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.send {\r\n\t\tbackground-color: #f7f7f7;\r\n\t\tpadding: 20rpx;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\r\n\t\t.sendText {\r\n\t\t\theight: 80rpx;\r\n\t\t\tline-height: 80rpx;\r\n\t\t\tpadding: 0rpx 20rpx;\r\n\t\t\tfont-size: 32rpx;\r\n\t\t\tflex: 1;\r\n\t\t\tborder-radius: 10rpx;\r\n\t\t\tbackground-color: #ffffff;\r\n\t\t\tmargin-right: 20rpx;\r\n\t\t}\r\n\r\n\t\t.sendBtn {\r\n\t\t\tfont-size: 30rpx;\r\n\t\t\theight: 80rpx;\r\n\t\t\tline-height: 80rpx;\r\n\t\t\tbackground-color: #85dbd0;\r\n\t\t\tcolor: #ffffff;\r\n\t\t}\r\n\r\n\t\t.sendBtn2 {\r\n\t\t\twidth: 50rpx;\r\n\t\t\theight: 50rpx;\r\n\t\t}\r\n\t}\r\n\r\n\t.picMode {\r\n\t\theight: 300rpx;\r\n\t\tpadding: 40rpx 80rpx;\r\n\t\tbackground-color: #f7f7f7;\r\n\t\tborder-top: 1rpx solid #e3e3e3;\r\n\t\tdisplay: flex;\r\n\r\n\t\t.btnPic {\r\n\t\t\twidth: 100rpx;\r\n\t\t\theight: 100rpx;\r\n\t\t\tmargin-right: 80rpx;\r\n\t\t}\r\n\r\n\t\t.btnTxt {\r\n\t\t\tfont-size: 26rpx;\r\n\t\t\twidth: 100rpx;\r\n\t\t\ttext-align: center;\r\n\t\t}\r\n\t}\r\n</style>\n","import mod from \"-!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=style&index=0&id=042db559&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../Download/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chat.vue?vue&type=style&index=0&id=042db559&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1651889798616\n      var cssReload = require(\"G:/Download/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}